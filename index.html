<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FMIR Kviz - Napredno</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Ostatak CSS-a ostaje isti kao u prethodnoj verziji */
        
        .github-status {
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            margin: 15px 0;
            font-weight: 600;
            display: none;
        }
        
        .loading {
            background-color: #e3f2fd;
            color: #1a2a6c;
            border: 1px solid #90caf9;
        }
        
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .github-info {
            background-color: #f0f7ff;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            border-left: 4px solid #1a2a6c;
        }
        
        .github-info a {
            color: #1a2a6c;
            font-weight: 600;
            text-decoration: none;
        }
        
        .github-info a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-graduation-cap"></i> FMIR Kviz - Napredne opcije</h1>
            <p>Automatski učitana pitanja sa GitHub repozitorijuma</p>
        </div>
        
        <div class="github-info">
            <p>Pitanja su automatski učitana sa GitHub repozitorijuma:</p>
            <p>
                <a href="https://github.com/showmy36663/fmirquizz/blob/main/fmir_all_questions_302_fixed.json" target="_blank">
                    <i class="fab fa-github"></i> fmir_all_questions_302_fixed.json
                </a>
            </p>
        </div>
        
        <div id="github-status" class="github-status loading">
            <i class="fas fa-spinner fa-spin"></i> Učitavanje pitanja sa GitHub-a...
        </div>
        
        <div class="instructions">
            <h3><i class="fas fa-info-circle"></i> Uputstvo za korišćenje</h3>
            <ol>
                <li>Pitanja su automatski učitana sa GitHub repozitorijuma</li>
                <li>Možete promeniti redosled pitanja ili učitati sopstveni JSON fajl</li>
                <li>Odgovarajte na pitanja i pratite svoj napredak</li>
            </ol>
        </div>
        
        <div class="upload-section">
            <div class="upload-icon">
                <i class="fas fa-file-upload"></i>
            </div>
            <div class="upload-text">
                Ili učitajte sopstveni JSON fajl sa pitanjima
            </div>
            <div class="file-input-wrapper">
                <button class="file-input-btn">
                    <i class="fas fa-folder-open"></i> Odaberite JSON fajl
                </button>
                <input type="file" id="json-file" accept=".json">
            </div>
            <div id="file-name" class="file-name">Nijedan fajl nije odabran</div>
            
            <div class="controls">
                <div class="control-group">
                    <label for="random-order">Nasumičan redosled pitanja:</label>
                    <label class="random-toggle">
                        <input type="checkbox" id="random-order" checked>
                        <span class="slider"></span>
                    </label>
                </div>
                
                <button id="start-quiz-btn" class="btn">
                    <i class="fas fa-play"></i> Pokreni kviz
                </button>
            </div>
        </div>
        
        <!-- Ostali elementi (progress, stats, pitanja, itd.) ostaju isti -->
        
    </div>

    <script>
        // Podaci za kviz - učitavaju se automatski sa GitHub-a
        let quizData = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let correctCount = 0;
        let incorrectCount = 0;
        let answerSubmitted = false;
        let userAnswers = [];
        let randomOrderEnabled = true; // Podrazumevano uključeno

        // DOM Elementi
        const githubStatus = document.getElementById('github-status');
        const jsonFileInput = document.getElementById('json-file');
        const fileNameElement = document.getElementById('file-name');
        const startQuizBtn = document.getElementById('start-quiz-btn');
        const randomOrderToggle = document.getElementById('random-order');
        // ... ostali DOM elementi ostaju isti ...

        // Funkcija za učitavanje JSON-a sa GitHub-a
        async function loadGitHubQuestions() {
            githubStatus.style.display = 'block';
            
            try {
                const response = await fetch('https://raw.githubusercontent.com/showmy36663/fmirquizz/main/fmir_all_questions_302_fixed.json');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                quizData = await response.json();
                
                // Validacija JSON-a
                if (!Array.isArray(quizData) || quizData.length === 0) {
                    throw new Error('Neispravan format JSON fajla');
                }
                
                githubStatus.className = 'github-status success';
                githubStatus.innerHTML = '<i class="fas fa-check-circle"></i> Pitanja su uspešno učitana sa GitHub-a!';
                
                // Inicijalizacija korisničkih odgovora
                userAnswers = Array(quizData.length).fill(null);
                
                // Priprema kviza
                prepareQuiz();
                
            } catch (error) {
                console.error('Greška pri učitavanju pitanja sa GitHub-a:', error);
                githubStatus.className = 'github-status error';
                githubStatus.innerHTML = `<i class="fas fa-exclamation-triangle"></i> Došlo je do greške pri učitavanju pitanja: ${error.message}`;
            }
        }

        // Priprema kviza nakon učitavanja pitanja
        function prepareQuiz() {
            // Nasumičan redosled ako je aktiviran
            randomOrderEnabled = randomOrderToggle.checked;
            if (randomOrderEnabled) {
                shuffleArray(quizData);
            }
            
            // Sakrij upload sekciju i prikaži komponente kviza
            document.querySelector('.upload-section').style.display = 'none';
            progressContainer.style.display = 'block';
            stats.style.display = 'flex';
            questionContainer.style.display = 'block';
            buttonsContainer.style.display = 'flex';
            
            // Resetuj kviz
            restartQuiz();
        }

        // Funkcija za nasumično mešanje niza
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // Promena fajla - ručno učitavanje
        jsonFileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                fileNameElement.textContent = `Odabran fajl: ${file.name}`;
                
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        quizData = JSON.parse(e.target.result);
                        
                        // Validacija JSON-a
                        if (!Array.isArray(quizData) || quizData.length === 0) {
                            throw new Error('Neispravan format JSON fajla');
                        }
                        
                        // Sakrij GitHub status
                        githubStatus.style.display = 'none';
                        
                        // Priprema kviza
                        prepareQuiz();
                        
                    } catch (error) {
                        console.error('Greška pri parsiranju JSON-a:', error);
                        errorMessage.style.display = 'block';
                    }
                };
                
                reader.onerror = function() {
                    errorMessage.style.display = 'block';
                };
                
                reader.readAsText(file);
            } else {
                fileNameElement.textContent = 'Nijedan fajl nije odabran';
            }
        });

        // Pokretanje kviza za ručno učitavanje
        startQuizBtn.addEventListener('click', function() {
            // Ako već nismo učitali pitanja sa GitHub-a
            if (quizData.length === 0) {
                const file = jsonFileInput.files[0];
                if (!file) {
                    errorMessage.textContent = 'Molimo odaberite JSON fajl sa pitanjima';
                    errorMessage.style.display = 'block';
                    return;
                }
                
                // Učitavanje će se obaviti kroz change event
                return;
            }
            
            prepareQuiz();
        });

        // Provera za nasumičan redosled
        randomOrderToggle.addEventListener('change', function() {
            randomOrderEnabled = this.checked;
            
            // Ako kviz već traje, ponovo mešamo pitanja
            if (quizData.length > 0) {
                if (randomOrderEnabled) {
                    shuffleArray(quizData);
                }
                restartQuiz();
            }
        });

        // Pokreni automatsko učitavanje pitanja sa GitHub-a pri učitavanju stranice
        window.addEventListener('DOMContentLoaded', loadGitHubQuestions);

        // ... ostale funkcije (showQuestion, checkAnswer, itd.) ostaju iste ...
    </script>
</body>
</html>
